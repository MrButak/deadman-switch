CREATE TABLE app_users (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    email TEXT UNIQUE NOT NULL,
    password TEXT NOT NULL,
    creation_date TIMESTAMP NOT NULL,
    provider VARCHAR(255) NOT NULL,
    email_verification_string TEXT,
    email_verified BOOLEAN NOT NULL
);

CREATE TABLE deadman_switches (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES app_users(id) NOT NULL,
    creation_date TIMESTAMP NOT NULL,
    check_in_interval_in_hours INTEGER CHECK (check_in_interval_in_hours > 0) NOT NULL,
    check_in_by_time TIMESTAMP,
    contact_email TEXT NOT NULL,
    final_message TEXT NOT NULL,
    triggered BOOLEAN NOT NULL
);

CREATE TABLE check_ins (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES app_users(id) NOT NULL,
    deadman_switch_id INTEGER REFERENCES deadman_switches(id) NOT NULL,
    check_in_time TIMESTAMP NOT NULL
);



** Below is not in use ***
CREATE TABLE user_contacts (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES app_users(id) NOT NULL,
    added_date TIMESTAMP,
    first_name VARCHAR(255) NOT NULL,
    last_name VARCHAR(255) NOT NULL,
    email TEXT NOT NULL,
    active BOOLEAN NOT NULL
);

CREATE TABLE user_preferences (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES app_users(id) NOT NULL,
    recipients TEXT [],
    check_in_interval_in_hours INTEGER CHECK (check_in_interval_in_hours > 0)
);

postgres://user:secret@localhost:5432/mydatabasename
